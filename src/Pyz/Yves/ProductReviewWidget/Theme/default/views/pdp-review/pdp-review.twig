{% extends template('widget') %}

{% define data = {
    idProductAbstract: _widget.idProductAbstract
} %}

{% block rating %}
    {% include molecule('rating-selector', 'ProductReviewWidget') with {
        data: {
            value: _widget.productReviewStorageTransfer.averageRating | default(0),
            reviewCount: _widget.productReviewStorageTransfer.reviewCount | default(''),
            maxValue: _widget.maximumRating
        },
        attributes: {
            readonly: true
        }
    } only %}
{% endblock %}

{% block body %}

    <div class="pdp-review">
        <div class="product-slider-title">
            <div class="">
                <h2 class="product-slider-title__text">{{ 'product_review.ratings_reviews' | trans }}</h2>
            </div>
            <div class="product-slider-title__line"></div>
            <div class="">
                <div class="grid grid--right is-hidden-sm-md">
                    {% if is_granted('IS_AUTHENTICATED_FULLY') %}
                        <span class="product-slider-title__link js-review__new-review-trigger">
                            {{ 'product_review.submit.add_a_review' | trans }}
                        </span>
                    {% else %}
                        <a class="product-slider-title__link" href="{{ path('login') }}">
                            {{ 'product_review.submit.add_a_review' | trans }}
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>

        {% include molecule('toggler-click') with {
            attributes: {
                'trigger-selector': '.js-review__new-review-trigger',
                'target-selector': '.js-review__new-review-form-target',
                'class-to-toggle': 'is-hidden'
            }
        } only %}
        {% include molecule('toggler-hash') with {
            attributes: {
                'trigger-hash': '#review',
                'target-selector': '.js-review__new-review-form-target',
                'class-to-toggle': 'is-hidden',
                'add-class-when-hash-in-url': false
            }
        } only %}

        {% if is_granted('IS_AUTHENTICATED_FULLY') %}
            <div class="popup popup--new-review is-hidden js-review__new-review-form-target">
                <div class="popup__overlay js-review__new-review-trigger"></div>
                <div class="popup__inner">
                    {{ render(path('product-review/submit', {'idProductAbstract': data.idProductAbstract})) }}
                </div>
            </div>
        {% endif %}

        {{ render(path('product-review/index', {'idProductAbstract': data.idProductAbstract})) }}
    </div>
{% endblock %}
